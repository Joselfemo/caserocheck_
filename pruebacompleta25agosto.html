<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CaseroCheck - Reseñas Reales de Alquileres en Madrid</title>

    <!-- Favicon SVG optimizado -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' stop-color='%23ffffff'/><stop offset='100%25' stop-color='%2306b6d4'/></linearGradient></defs><rect width='100' height='100' rx='20' fill='%232563eb'/><path d='M20 55L50 25L80 55V75A5 5 0 0175 80H25A5 5 0 0120 75Z' fill='url(%23g)'/><rect x='40' y='60' width='20' height='20' fill='%232563eb'/><rect x='30' y='45' width='8' height='12' fill='%23fbbf24'/><rect x='62' y='45' width='8' height='12' fill='%23fbbf24'/></svg>">

    <!-- Preload recursos críticos -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">

    <!-- SEO Optimizado -->
    <meta name="description" content="Reseñas reales y verificadas de alquileres en Madrid. Descubre experiencias auténticas de inquilinos, precios reales y evita sorpresas antes de firmar tu contrato.">
    <meta name="keywords" content="alquiler Madrid, reseñas caseros, experiencias alquiler, propiedades Madrid, inquilinos, pisos Madrid, apartamentos">
    <meta name="author" content="CaseroCheck">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://caserocheck.es">

    <!-- Open Graph optimizado -->
    <meta property="og:title" content="CaseroCheck - Reseñas Reales de Alquileres en Madrid">
    <meta property="og:description" content="La primera plataforma de reseñas verificadas de alquileres en Madrid. Información real, decisiones inteligentes.">
    <meta property="og:url" content="https://caserocheck.es">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="CaseroCheck">
    <meta property="og:locale" content="es_ES">

    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="CaseroCheck - Reseñas Reales de Alquileres en Madrid">
    <meta name="twitter:description" content="La primera plataforma de reseñas verificadas de alquileres en Madrid.">
    <meta name="twitter:site" content="@CaseroCheck">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BKWYK023X6"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-BKWYK023X6');
    </script>

    <!-- Librerías externas - Cargadas de forma optimizada -->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css">

    <!-- CSS OPTIMIZADO - Solo las variables y estilos críticos -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Paleta de colores principal */
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --primary-dark: #1d4ed8;
            --secondary: #06b6d4;
            --accent: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1f2937;
            --white: #ffffff;

            /* Escala de grises */
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;

            /* Espaciado responsive - Solo los necesarios */
            --space-xs: clamp(0.5rem, 1vw, 0.75rem);
            --space-sm: clamp(0.75rem, 1.5vw, 1rem);
            --space-md: clamp(1rem, 2vw, 1.5rem);
            --space-lg: clamp(1.5rem, 3vw, 2rem);
            --space-xl: clamp(2rem, 4vw, 3rem);
            --space-2xl: clamp(3rem, 6vw, 4rem);

            /* Tipografía escalable */
            --text-xs: clamp(0.75rem, 1vw, 0.875rem);
            --text-sm: clamp(0.875rem, 1.2vw, 1rem);
            --text-base: clamp(1rem, 1.4vw, 1.125rem);
            --text-lg: clamp(1.125rem, 1.6vw, 1.25rem);
            --text-xl: clamp(1.25rem, 1.8vw, 1.5rem);
            --text-2xl: clamp(1.5rem, 2.2vw, 2rem);
            --text-3xl: clamp(1.875rem, 2.8vw, 2.5rem);
            --text-4xl: clamp(2.25rem, 3.5vw, 3.5rem);
            --text-5xl: clamp(3rem, 5vw, 4.5rem);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
            font-size: var(--text-base);
        }

        /* Animaciones críticas */
        @keyframes fadeInUp {
            0% { opacity: 0; transform: translateY(30px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(-50%) scale(1); opacity: 1; }
            50% { transform: translateY(-55%) scale(1.05); opacity: 0.9; }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Container principal optimizado */
        .container {
            max-width: min(1400px, 95vw);
            margin: 0 auto;
            background: var(--white);
            border-radius: clamp(16px, 2vw, 24px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin: var(--space-md);
            animation: fadeInUp 0.8s ease-out;
        }

        /* Hero Header optimizado */
        .hero-header {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.7) 0%, rgba(29, 78, 216, 0.75) 50%, rgba(6, 182, 212, 0.7) 100%),
                        url('https://images.unsplash.com/photo-1539037116277-4db20889f2d4?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80') center/cover;
            padding: var(--space-2xl) var(--space-xl);
            text-align: center;
            position: relative;
            overflow: hidden;
            min-height: clamp(60vh, 70vh, 80vh);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hero-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 20% 80%, rgba(37, 99, 235, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(6, 182, 212, 0.3) 0%, transparent 50%),
                linear-gradient(45deg, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.05) 100%);
            animation: float 8s ease-in-out infinite;
            pointer-events: none;
        }

        .hero-header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: clamp(60px, 10vw, 100px);
            background: linear-gradient(to top, rgba(255,255,255,1) 0%, rgba(255,255,255,0.8) 50%, transparent 100%);
            pointer-events: none;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            max-width: 1200px;
            width: 100%;
            padding: 0 var(--space-md);
        }

        .hero-title {
            font-size: var(--text-5xl);
            font-weight: 900;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 30%, #e2e8f0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: var(--space-lg);
            letter-spacing: -0.05em;
            text-shadow: 0 8px 32px rgba(0,0,0,0.3);
            position: relative;
            display: inline-block;
        }

        .hero-title::before {
            content: '';
            position: absolute;
            left: clamp(-60px, -8vw, -80px);
            top: 50%;
            transform: translateY(-50%);
            width: clamp(40px, 6vw, 65px);
            height: clamp(40px, 6vw, 65px);
            background: linear-gradient(135deg, #ffffff 0%, #06b6d4 100%);
            mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12.97 2.59a1.5 1.5 0 00-1.94 0l-7.5 6.363A1.5 1.5 0 003 10.097V19.5A1.5 1.5 0 004.5 21h4.75a.75.75 0 00.75-.75V14h4v6.25c0 .414.336.75.75.75H19.5a1.5 1.5 0 001.5-1.5v-9.403c0-.44-.194-.859-.53-1.144l-7.5-6.363z'/%3E%3C/svg%3E") no-repeat center;
            mask-size: contain;
            animation: float 3s ease-in-out infinite;
            filter: drop-shadow(0 4px 16px rgba(255,255,255,0.4));
            border-radius: 12px;
        }

        .hero-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: clamp(150px, 20vw, 200px);
            height: 4px;
            background: linear-gradient(90deg, transparent 0%, #06b6d4 50%, transparent 100%);
            border-radius: 2px;
        }

        .hero-subtitle {
            font-size: var(--text-xl);
            color: rgba(255,255,255,0.95);
            margin-bottom: var(--space-md);
            font-weight: 600;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            text-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .hero-description {
            font-size: var(--text-lg);
            color: rgba(255,255,255,0.9);
            margin-bottom: var(--space-xl);
            font-weight: 400;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.7;
        }

        /* Botones CTA optimizados */
        .hero-cta {
            display: flex;
            gap: var(--space-md);
            justify-content: center;
            margin-bottom: var(--space-2xl);
            flex-wrap: wrap;
        }

        .cta-primary, .cta-secondary {
            padding: var(--space-md) var(--space-xl);
            border: none;
            border-radius: 16px;
            font-size: var(--text-lg);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            min-width: clamp(180px, 25vw, 220px);
            font-family: inherit;
        }

        .cta-primary {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            color: var(--primary);
            box-shadow: 0 8px 32px rgba(255,255,255,0.3);
        }

        .cta-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(255,255,255,0.4);
        }

        .cta-secondary {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            backdrop-filter: blur(10px);
        }

        .cta-secondary:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-3px);
        }

        /* Hero Stats optimizado */
        .hero-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-lg);
            margin-top: var(--space-2xl);
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-stat {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: var(--space-lg);
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }

        .hero-stat:hover {
            transform: translateY(-4px);
            background: rgba(255,255,255,0.15);
        }

        .hero-stat-number {
            font-size: var(--text-4xl);
            font-weight: 900;
            color: var(--white);
            margin-bottom: var(--space-xs);
            line-height: 1;
        }

        .hero-stat-label {
            font-size: var(--text-sm);
            color: rgba(255,255,255,0.8);
            font-weight: 500;
        }

        /* Navegación optimizada */
        .nav-tabs {
            display: flex;
            background: var(--gray-50);
            padding: var(--space-sm);
            margin: 0;
            border-bottom: 1px solid var(--gray-200);
            gap: var(--space-xs);
            overflow-x: auto;
            scroll-behavior: smooth;
        }

        .nav-tab {
            flex: 1;
            min-width: max-content;
            padding: var(--space-md) var(--space-sm);
            background: transparent;
            border: none;
            border-radius: 12px;
            color: var(--gray-600);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: var(--text-sm);
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-xs);
            white-space: nowrap;
            font-family: inherit;
        }

        .nav-tab:hover:not(.active) {
            background: var(--gray-100);
            color: var(--gray-700);
            transform: translateY(-1px);
        }

        .nav-tab.active {
            background: var(--primary);
            color: var(--white);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .nav-tab-icon {
            font-size: var(--text-lg);
        }

        /* Contenido principal */
        .main-content {
            padding: var(--space-xl);
            min-height: 600px;
        }

        .tab-content {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }

        .tab-content.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        /* Responsive optimizado */
        @media (max-width: 768px) {
            .hero-title::before {
                display: none;
            }

            .hero-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: var(--space-md);
            }

            .cta-primary, .cta-secondary {
                min-width: 100%;
            }

            .main-content {
                padding: var(--space-lg);
            }

            .nav-tabs {
                flex-direction: column;
                gap: var(--space-xs);
                padding: var(--space-md);
            }

            .nav-tab {
                justify-content: center;
                margin: 0;
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .hero-header {
                padding: var(--space-xl) var(--space-md);
            }

            .hero-content {
                padding: 0;
            }

            .nav-tabs {
                padding: var(--space-sm);
            }

            .nav-tab {
                padding: var(--space-sm);
                font-size: var(--text-xs);
            }
        }

        /* Tablets */
        @media (min-width: 768px) and (max-width: 1024px) {
            .hero-stats {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Desktop grande */
        @media (min-width: 1440px) {
            .container {
                max-width: 1600px;
                margin: var(--space-xl) auto;
            }

            .hero-stats {
                grid-template-columns: repeat(4, 1fr);
                max-width: 1200px;
            }

            .hero-title::before {
                left: -100px;
                width: 80px;
                height: 80px;
            }

            .main-content {
                padding: var(--space-2xl);
            }
        }

        /* 4K y ultrapantallas */
        @media (min-width: 1920px) {
            .container {
                max-width: 1800px;
                margin: var(--space-2xl) auto;
            }

            .hero-content {
                max-width: 1400px;
            }

            .hero-stats {
                max-width: 1400px;
            }
        }

        /* Utilities - Solo las necesarias */
        .animate-on-scroll {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.6s ease;
        }

        .animate-on-scroll.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--gray-200);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        .loading {
            display: none;
            text-align: center;
            padding: var(--space-2xl);
        }

        .loading.show {
            display: block;
        }

        .error {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: var(--danger);
            padding: var(--space-lg);
            border-radius: 12px;
            text-align: center;
            border: 1px solid #fca5a5;
            margin: var(--space-lg) 0;
        }

        .success {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            color: #065f46;
            padding: var(--space-lg);
            border-radius: 12px;
            text-align: center;
            border: 1px solid #6ee7b7;
            margin: var(--space-lg) 0;
        }

        /* Demo badge para datos ficticios */
        .demo-badge {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            padding: var(--space-xs) var(--space-sm);
            border-radius: 20px;
            font-size: var(--text-xs);
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            margin-bottom: var(--space-md);
            box-shadow: 0 2px 8px rgba(251, 191, 36, 0.3);
        }

        /* Performance optimizations */
        .hero-header {
            will-change: transform;
            transform: translateZ(0);
        }

        .nav-tab, .cta-primary, .cta-secondary, .hero-stat {
            will-change: transform;
        }
    </style>
</head>
<body>
<!-- PARTE 2: HERO SECTION + NAVIGATION -->
<!-- Insertar DESPUÉS del <body> de la Parte 1 -->

<div class="container">
    <!-- Hero Header con Stats Reales -->
    <div class="hero-header">
        <div class="hero-content">
            <h1 class="hero-title">CaseroCheck</h1>
            <p class="hero-subtitle">🏙️ <strong>La primera plataforma de reseñas reales</strong> para alquileres en Madrid</p>
            <p class="hero-description">Descubre experiencias auténticas de inquilinos como tú. Conoce la verdad sobre precios, caseros y propiedades antes de firmar tu contrato. <strong>Información real, decisiones inteligentes.</strong></p>

            <div class="hero-cta">
                <button class="cta-primary" onclick="switchTabAndScroll('search')">
                    🔍 Buscar Propiedades
                </button>
                <button class="cta-secondary" onclick="switchTabAndScroll('write')">
                    ✍️ Escribir Reseña
                </button>
            </div>

            <!-- HERO STATS - DATOS REALES -->
            <div class="hero-stats">
                <div class="hero-stat">
                    <div class="hero-stat-number" id="totalReviews">0</div>
                    <div class="hero-stat-label">Reseñas Verificadas</div>
                    <div class="hero-stat-badge">📊 REAL</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-number" id="avgRating">4.2</div>
                    <div class="hero-stat-label">Rating Promedio</div>
                    <div class="hero-stat-badge">📊 REAL</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-number" id="districts">21</div>
                    <div class="hero-stat-label">Distritos Cubiertos</div>
                    <div class="hero-stat-badge">📊 REAL</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-number" id="totalProperties">0</div>
                    <div class="hero-stat-label">Propiedades Únicas</div>
                    <div class="hero-stat-badge">📊 REAL</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navegación Optimizada -->
    <div class="nav-tabs">
        <button class="nav-tab active" onclick="switchTab('search')" data-tab="search">
            <span class="nav-tab-icon">🔍</span>
            <span>Buscar Reseñas</span>
        </button>
        <button class="nav-tab" onclick="switchTab('write')" data-tab="write">
            <span class="nav-tab-icon">✍️</span>
            <span>Escribir Reseña</span>
        </button>
        <button class="nav-tab" onclick="switchTab('analytics')" data-tab="analytics">
            <span class="nav-tab-icon">📊</span>
            <span>Estadísticas</span>
            <span class="demo-indicator">DEMO</span>
        </button>
        <button class="nav-tab" onclick="switchTab('map')" data-tab="map">
            <span class="nav-tab-icon">🗺️</span>
            <span>Mapa</span>
        </button>
        <button class="nav-tab" onclick="switchTab('insights')" data-tab="insights">
            <span class="nav-tab-icon">💡</span>
            <span>Análisis IA</span>
            <span class="demo-indicator">DEMO</span>
        </button>
    </div>

    <!-- Contenido Principal -->
    <div class="main-content">
        <!-- Tab: Búsqueda - DATOS REALES -->
        <div id="search-tab" class="tab-content active">
            <div class="form-section animate-on-scroll">
                <h3>🔍 Buscar Reseñas de Propiedades</h3>
                <p class="section-description">Encuentra reseñas reales de inquilinos sobre propiedades en Madrid</p>

                <form class="form-grid" id="searchForm">
                    <div class="form-group">
                        <label for="direccion">📍 Dirección o Calle</label>
                        <input type="text" id="direccion" placeholder="Gran Vía, Calle Mayor..." autocomplete="street-address">
                    </div>

                    <div class="form-group">
                        <label for="distrito">🏘️ Distrito</label>
                        <select id="distrito" autocomplete="address-level2">
                            <option value="">Todos los distritos</option>
                            <option value="Centro">Centro</option>
                            <option value="Arganzuela">Arganzuela</option>
                            <option value="Retiro">Retiro</option>
                            <option value="Salamanca">Salamanca</option>
                            <option value="Chamartín">Chamartín</option>
                            <option value="Tetuán">Tetuán</option>
                            <option value="Chamberí">Chamberí</option>
                            <option value="Fuencarral-El Pardo">Fuencarral-El Pardo</option>
                            <option value="Moncloa-Aravaca">Moncloa-Aravaca</option>
                            <option value="Latina">Latina</option>
                            <option value="Carabanchel">Carabanchel</option>
                            <option value="Usera">Usera</option>
                            <option value="Puente de Vallecas">Puente de Vallecas</option>
                            <option value="Moratalaz">Moratalaz</option>
                            <option value="Ciudad Lineal">Ciudad Lineal</option>
                            <option value="Hortaleza">Hortaleza</option>
                            <option value="Villaverde">Villaverde</option>
                            <option value="Villa de Vallecas">Villa de Vallecas</option>
                            <option value="Vicálvaro">Vicálvaro</option>
                            <option value="San Blas-Canillejas">San Blas-Canillejas</option>
                            <option value="Barajas">Barajas</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="precioMin">💰 Precio Mínimo (€)</label>
                        <input type="number" id="precioMin" placeholder="400" min="0" max="5000" step="50">
                    </div>

                    <div class="form-group">
                        <label for="precioMax">💰 Precio Máximo (€)</label>
                        <input type="number" id="precioMax" placeholder="1500" min="0" max="5000" step="50">
                    </div>

                    <div class="form-group">
                        <label for="habitaciones">🛏️ Habitaciones</label>
                        <select id="habitaciones">
                            <option value="">Cualquier número</option>
                            <option value="0">Estudio (0 hab.)</option>
                            <option value="1">1 habitación</option>
                            <option value="2">2 habitaciones</option>
                            <option value="3">3 habitaciones</option>
                            <option value="4">4+ habitaciones</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="tipoPropiedad">🏠 Tipo de Propiedad</label>
                        <select id="tipoPropiedad">
                            <option value="">Todos los tipos</option>
                            <option value="Piso">Piso</option>
                            <option value="Estudio">Estudio</option>
                            <option value="Ático">Ático</option>
                            <option value="Loft">Loft</option>
                            <option value="Casa">Casa</option>
                            <option value="Habitación">Habitación</option>
                        </select>
                    </div>

                    <div class="form-group form-group-full">
                        <button type="submit" class="btn btn-primary btn-large">
                            <span class="btn-icon">🚀</span>
                            Buscar Propiedades
                        </button>
                    </div>
                </form>

                <!-- Filtros Avanzados (Colapsables) -->
                <div class="advanced-filters" id="advancedFilters" style="display: none;">
                    <h4>🔧 Filtros Avanzados</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="amueblado">🪑 Amueblado</label>
                            <select id="amueblado">
                                <option value="">Cualquiera</option>
                                <option value="Sí">Sí</option>
                                <option value="No">No</option>
                                <option value="Semi-amueblado">Semi-amueblado</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="ratingMin">⭐ Rating Mínimo</label>
                            <select id="ratingMin">
                                <option value="">Cualquier rating</option>
                                <option value="4.5">4.5+ Excelente</option>
                                <option value="4.0">4.0+ Muy bueno</option>
                                <option value="3.5">3.5+ Bueno</option>
                                <option value="3.0">3.0+ Regular</option>
                            </select>
                        </div>
                    </div>
                </div>

                <button type="button" class="btn-toggle-filters" onclick="toggleAdvancedFilters()">
                    <span id="toggleFiltersText">Mostrar filtros avanzados</span>
                    <span id="toggleFiltersIcon">▼</span>
                </button>
            </div>

            <!-- Loading State -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Analizando reseñas reales...</p>
                <small>Buscando en nuestra base de datos verificada</small>
            </div>

            <!-- Resultados de Búsqueda -->
            <div id="searchResults">
                <div class="welcome-message">
                    <div class="welcome-icon">🚀</div>
                    <h3>¡Bienvenido a CaseroCheck v3.0!</h3>
                    <p>Usa los filtros para encontrar información detallada sobre alquileres en Madrid.</p>
                    <div class="welcome-features">
                        <span class="feature-badge">✅ Reseñas verificadas</span>
                        <span class="feature-badge">📊 Datos reales</span>
                        <span class="feature-badge">🤖 IA integrada</span>
                        <span class="feature-badge">🗺️ Mapa interactivo</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- PLACEHOLDER para otros tabs - se completan en las siguientes partes -->
        <div id="write-tab" class="tab-content">
            <!-- Formulario de reseñas - Parte 5 -->
        </div>

        <div id="analytics-tab" class="tab-content">
            <!-- Analytics DEMO - Parte 6 -->
        </div>

        <div id="map-tab" class="tab-content">
            <!-- Mapa funcional - Parte 4 -->
        </div>

        <div id="insights-tab" class="tab-content">
            <!-- IA Insights DEMO - Parte 6 -->
        </div>
    </div>
</div>

<!-- CSS ADICIONAL para Hero Stats + Navigation + Search -->
<style>
    /* Hero Stats - Badges para identificar datos reales */
    .hero-stat-badge {
        font-size: var(--text-xs);
        background: rgba(16, 185, 129, 0.2);
        color: rgba(16, 185, 129, 1);
        padding: 2px 6px;
        border-radius: 8px;
        margin-top: var(--space-xs);
        font-weight: 600;
        border: 1px solid rgba(16, 185, 129, 0.3);
    }

    /* Demo indicators en navegación */
    .demo-indicator {
        font-size: 10px;
        background: var(--warning);
        color: white;
        padding: 2px 4px;
        border-radius: 4px;
        margin-left: 4px;
        font-weight: 700;
    }

    /* Form sections optimizadas */
    .form-section {
        background: var(--gray-50);
        padding: var(--space-xl);
        border-radius: 20px;
        margin-bottom: var(--space-xl);
        border: 1px solid var(--gray-200);
        position: relative;
    }

    .form-section h3 {
        font-size: var(--text-2xl);
        font-weight: 700;
        color: var(--dark);
        margin-bottom: var(--space-sm);
        display: flex;
        align-items: center;
        gap: var(--space-sm);
    }

    .section-description {
        color: var(--gray-600);
        margin-bottom: var(--space-lg);
        font-size: var(--text-base);
    }

    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(min(100%, 280px), 1fr));
        gap: var(--space-lg);
        max-width: 100%;
    }

    .form-group {
        position: relative;
    }

    .form-group-full {
        grid-column: 1 / -1;
    }

    .form-group label {
        display: block;
        font-weight: 600;
        margin-bottom: var(--space-xs);
        color: var(--dark);
        font-size: var(--text-sm);
    }

    .form-group input,
    .form-group select {
        width: 100%;
        padding: var(--space-md);
        border: 2px solid var(--gray-200);
        border-radius: 12px;
        font-size: var(--text-base);
        background: var(--white);
        transition: all 0.3s ease;
        outline: none;
        font-family: inherit;
    }

    .form-group input:focus,
    .form-group select:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        transform: translateY(-1px);
    }

    .form-group input:hover,
    .form-group select:hover {
        border-color: var(--gray-300);
    }

    /* Botones optimizados */
    .btn {
        padding: var(--space-md) var(--space-lg);
        border: none;
        border-radius: 12px;
        font-size: var(--text-base);
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: var(--space-xs);
        text-decoration: none;
        font-family: inherit;
        justify-content: center;
    }

    .btn-primary {
        background: var(--primary);
        color: var(--white);
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
    }

    .btn-primary:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(37, 99, 235, 0.3);
    }

    .btn-primary:active {
        transform: translateY(0);
    }

    .btn-large {
        padding: var(--space-lg) var(--space-xl);
        font-size: var(--text-lg);
        width: 100%;
        min-height: 56px;
    }

    .btn-icon {
        font-size: 1.2em;
    }

    /* Filtros avanzados */
    .advanced-filters {
        background: var(--white);
        padding: var(--space-lg);
        border-radius: 12px;
        margin-top: var(--space-lg);
        border: 1px solid var(--gray-200);
        animation: fadeInUp 0.3s ease;
    }

    .advanced-filters h4 {
        font-size: var(--text-lg);
        font-weight: 700;
        margin-bottom: var(--space-md);
        color: var(--dark);
        display: flex;
        align-items: center;
        gap: var(--space-sm);
    }

    .btn-toggle-filters {
        background: transparent;
        border: 1px solid var(--gray-300);
        color: var(--gray-600);
        padding: var(--space-sm) var(--space-md);
        border-radius: 8px;
        font-size: var(--text-sm);
        cursor: pointer;
        transition: all 0.2s ease;
        margin-top: var(--space-md);
        display: flex;
        align-items: center;
        gap: var(--space-xs);
    }

    .btn-toggle-filters:hover {
        background: var(--gray-50);
        border-color: var(--gray-400);
    }

    /* Welcome message optimizada */
    .welcome-message {
        text-align: center;
        padding: var(--space-2xl);
        color: var(--gray-600);
        background: var(--white);
        border-radius: 16px;
        border: 1px solid var(--gray-200);
    }

    .welcome-icon {
        font-size: var(--text-5xl);
        margin-bottom: var(--space-lg);
        opacity: 0.8;
    }

    .welcome-message h3 {
        font-size: var(--text-2xl);
        font-weight: 700;
        margin-bottom: var(--space-md);
        color: var(--dark);
    }

    .welcome-message p {
        font-size: var(--text-lg);
        max-width: 500px;
        margin: 0 auto var(--space-lg);
        line-height: 1.6;
    }

    .welcome-features {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: var(--space-sm);
    }

    .feature-badge {
        background: linear-gradient(135deg, var(--primary-light), var(--secondary));
        color: white;
        padding: var(--space-xs) var(--space-sm);
        border-radius: 20px;
        font-size: var(--text-xs);
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 4px;
    }

    /* Responsive para navigation y forms */
    @media (max-width: 768px) {
        .form-grid {
            grid-template-columns: 1fr;
        }

        .welcome-features {
            flex-direction: column;
            align-items: center;
        }

        .feature-badge {
            justify-content: center;
        }
    }

    @media (max-width: 480px) {
        .form-section {
            padding: var(--space-lg);
        }

        .nav-tab {
            padding: var(--space-sm);
            font-size: var(--text-xs);
        }

        .nav-tab-icon {
            font-size: var(--text-base);
        }

        .demo-indicator {
            display: none;
        }
    }

    /* Performance optimizations */
    .form-group input,
    .form-group select,
    .btn {
        will-change: transform, box-shadow;
    }

    /* Accessibility */
    .btn:focus-visible,
    .form-group input:focus-visible,
    .form-group select:focus-visible {
        outline: 2px solid var(--primary);
        outline-offset: 2px;
    }

    /* Validación visual */
    .form-group input:invalid {
        border-color: var(--danger);
    }

    .form-group input:valid {
        border-color: var(--accent);
    }

    /* Estados de carga en inputs */
    .form-group.loading input,
    .form-group.loading select {
        opacity: 0.6;
        pointer-events: none;
        background-image: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
        background-size: 200% 100%;
        animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
        0% { background-position: -200% 0; }
        100% { background-position: 200% 0; }
    }
</style>

<!-- JavaScript para navegación y filtros básicos -->
<script>
    // Funciones básicas de navegación - Las funciones principales van en Parte 3
    function switchTab(tabName) {
        // Remover clase active de todas las pestañas
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.classList.remove('active');
        });

        // Activar la pestaña seleccionada
        document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

        // Ocultar todo el contenido
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });

        // Mostrar el contenido seleccionado
        const targetTab = document.getElementById(tabName + '-tab');
        if (targetTab) {
            targetTab.classList.add('active');
        }
    }

    function switchTabAndScroll(tabName) {
        switchTab(tabName);
        setTimeout(() => {
            document.querySelector('.nav-tabs').scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }, 100);
    }

    function toggleAdvancedFilters() {
        const filters = document.getElementById('advancedFilters');
        const text = document.getElementById('toggleFiltersText');
        const icon = document.getElementById('toggleFiltersIcon');

        if (filters.style.display === 'none') {
            filters.style.display = 'block';
            text.textContent = 'Ocultar filtros avanzados';
            icon.textContent = '▲';
        } else {
            filters.style.display = 'none';
            text.textContent = 'Mostrar filtros avanzados';
            icon.textContent = '▼';
        }
    }

    // Inicialización básica
    document.addEventListener('DOMContentLoaded', function() {
        console.log('🚀 CaseroCheck v3.0 - Hero y Navigation cargados');

        // Activar animaciones cuando sea visible
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        });

        document.querySelectorAll('.animate-on-scroll').forEach(el => {
            observer.observe(el);
        });
    });
</script>
<!-- PARTE 3A: JAVASCRIPT CORE + DATA MANAGEMENT -->
<!-- Insertar ANTES del </body> de la estructura completa -->

<script>
// ==========================================
// CASEROCHECK v3.0 - SISTEMA CORE OPTIMIZADO
// ==========================================

// Configuración principal
const CONFIG = {
    SHEET_ID: '1hsiAtQCmagED_5iDbhT8xHxHRZ5AYpi1bz0LTBO1DaQ',
    API_KEY: 'AIzaSyDLP_UxlbG8OHIwAYvfbps4PkcZmzjkLJw',
    RANGE: 'Reseñas!A2:AC1000',
    APPS_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbw5D8_5MlK0KLnQgWT6gTluxbaHpVdl9DbG9qd4MbWFDlffzZlFuP4A1As0ITryNAxeuw/exec',
    CACHE_TIMEOUT: 5 * 60 * 1000, // 5 minutos
    OFFLINE_CACHE_TIMEOUT: 30 * 60 * 1000 // 30 minutos para offline
};

// Mapeo de columnas de Google Sheets
const COLUMNS = {
    ID: 0, FECHA: 1, DIRECCION: 2, CODIGO_POSTAL: 3, DISTRITO: 4,
    PRECIO_PAGADO: 5, PRECIO_ANUNCIADO: 6, DURACION_ALQUILER: 7,
    TIPO_PROPIEDAD: 8, METROS: 9, HABITACIONES: 10, BANOS: 11,
    AMUEBLADO: 12, CALIFICACION_GLOBAL: 13, ESTADO_PISO: 14,
    LIMPIEZA: 15, UBICACION: 16, CALIDAD_PRECIO: 17,
    COMUNICACION_CASERO: 18, TIEMPO_RESPUESTA: 19,
    PROBLEMAS_REPORTADOS: 20, RESOLUCION_PROBLEMAS: 21,
    DEVOLUCION_FIANZA: 22, TIEMPO_DEVOLUCION: 23,
    RESENA_DETALLADA: 24, RECOMENDARIAS: 25, EMAIL_USUARIO: 26,
    VERIFICADO: 27, ESTADO_MODERACION: 28, NOTAS_ADMIN: 29
};

// Variables globales del sistema
let allData = [];
let dataCache = {
    lastUpdate: null,
    data: null,
    isLoading: false
};

// ==========================================
// GESTOR DE DATOS PRINCIPAL
// ==========================================
class DataManager {
    constructor() {
        this.real = {
            reviews: [],
            heroStats: {},
            searchResults: [],
            uniqueProperties: []
        };

        // Datos DEMO para Analytics e IA - Claramente separados
        this.demo = {
            analytics: {
                priceEvolution: [1200, 1250, 1180, 1320, 1280, 1350],
                monthlyLabels: ['Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
                districtRatings: {
                    'Centro': 3.8,
                    'Salamanca': 4.5,
                    'Chamberí': 4.3,
                    'Retiro': 4.1,
                    'Usera': 4.2
                },
                priceDistribution: {
                    labels: ['<€800', '€800-1200', '€1200-1600', '>€1600'],
                    data: [15, 35, 35, 15]
                },
                marketInsights: [
                    { type: 'success', title: 'Mejor Relación Calidad-Precio', text: 'Tetuán y Usera ofrecen los mejores precios con ratings altos. Precio medio: €950/mes con 4.3/5 de satisfacción.' },
                    { type: 'warning', title: 'Red Flag: Centro', text: '85% de diferencias entre precio anunciado vs real. Promedio: €180 más caro de lo anunciado. Revisar ofertas con cuidado.' },
                    { type: 'info', title: 'Trending: Malasaña', text: 'Precios subiendo 12% este trimestre. Alta demanda de jóvenes profesionales. Mercado muy competitivo.' }
                ]
            },
            aiPredictions: {
                priceForecasts: [1380, 1420, 1390, 1450, 1480, 1520],
                forecastLabels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
                riskAnalysis: {
                    'Salamanca': { level: 'low', score: 2.1, color: 'success' },
                    'Chamberí': { level: 'low', score: 2.4, color: 'success' },
                    'Centro': { level: 'medium', score: 5.7, color: 'warning' },
                    'Lavapiés': { level: 'high', score: 7.8, color: 'danger' }
                },
                aiInsights: [
                    { icon: '⚡', title: 'Predicción: Devolución de Fianza Rápida', text: 'Algoritmo detecta: Salamanca y Chamberí tienen 95% probabilidad de devolución completa en <15 días.', metrics: ['Precisión: 94%', 'Datos: 847 casos'] },
                    { icon: '🚨', title: 'Alerta IA: Zonas de Riesgo Emergente', text: 'Algoritmo detecta: Lavapiés muestra 40% de problemas vs 15% media Madrid.', metrics: ['Confianza: 89%', 'Tendencia: ↗'] },
                    { icon: '📊', title: 'IA Predictiva: Mercado Q1 2025', text: 'Predicción precios: Retiro -2%, Centro +1%, Malasaña +3%.', metrics: ['Horizonte: 3 meses', 'Actualización: Diaria'] },
                    { icon: '🎯', title: 'Sweet Spot IA: Tetuán', text: 'Algoritmo optimiza: Balance perfecto precio/calidad detectado en Tetuán.', metrics: ['Score IA: 9.2/10', 'Recomendación: Alta'] }
                ]
            }
        };
    }

    // Obtener datos reales
    getRealData() {
        return this.real;
    }

    // Obtener datos DEMO (claramente marcados)
    getDemoData() {
        return this.demo;
    }

    // Actualizar datos reales
    updateRealData(newData) {
        this.real.reviews = newData;
        this.calculateRealStats();
    }

    // Calcular estadísticas reales basadas en las reseñas
    calculateRealStats() {
        const reviews = this.real.reviews;

        if (reviews.length === 0) {
            this.real.heroStats = {
                totalReviews: 0,
                avgRating: 0,
                districts: 0,
                totalProperties: 0
            };
            return;
        }

        // Calcular rating promedio
        const avgRating = reviews.reduce((sum, item) => sum + item.calificacionGlobal, 0) / reviews.length;

        // Calcular distritos únicos
        const uniqueDistricts = [...new Set(reviews.map(item => item.distrito))].length;

        // Calcular propiedades únicas (por dirección)
        const uniqueAddresses = [...new Set(reviews.map(item => item.direccion.toLowerCase().trim()))];
        this.real.uniqueProperties = uniqueAddresses;

        this.real.heroStats = {
            totalReviews: reviews.length,
            avgRating: Math.round(avgRating * 10) / 10,
            districts: uniqueDistricts,
            totalProperties: uniqueAddresses.length
        };

        console.log('📊 Stats reales calculadas:', this.real.heroStats);
    }
}

// ==========================================
// CLASE PRINCIPAL CASEROCHECK
// ==========================================
class CaseroCheck {
    constructor() {
        console.log('🚀 CaseroCheck v3.0 - Iniciando sistema optimizado...');

        this.dataManager = new DataManager();
        this.isInitialized = false;

        // Inicializar sistema
        this.init();
    }

    async init() {
        try {
            // Cargar datos reales
            await this.loadRealData();

            // Actualizar Hero Stats con datos reales
            this.updateHeroStats();

            // Inicializar componentes
            this.initializeSearch();
            this.initializeAnimations();

            // Marcar como inicializado
            this.isInitialized = true;

            console.log('✅ CaseroCheck inicializado correctamente');

        } catch (error) {
            console.error('❌ Error inicializando CaseroCheck:', error);
            this.handleInitError();
        }
    }

    // ==========================================
    // CARGA DE DATOS REALES
    // ==========================================
    async loadRealData() {
        console.log('🌐 Cargando datos reales desde Google Sheets...');

        // Verificar caché válido
        if (this.isCacheValid()) {
            console.log('📋 Usando datos en caché válidos');
            allData = dataCache.data;
            this.dataManager.updateRealData(allData);
            return;
        }

        // Evitar cargas múltiples
        if (dataCache.isLoading) {
            console.log('⏳ Carga ya en proceso...');
            return;
        }

        dataCache.isLoading = true;

        try {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.SHEET_ID}/values/${CONFIG.RANGE}?key=${CONFIG.API_KEY}`;
            const response = await fetch(url);

            if (response.ok) {
                const data = await response.json();
                if (data.values && data.values.length > 0) {
                    console.log('✅ Datos reales cargados:', data.values.length, 'filas');

                    // Procesar datos reales
                    allData = this.processRealData(data.values);

                    // Actualizar caché
                    dataCache.data = allData;
                    dataCache.lastUpdate = Date.now();
                    this.saveToLocalStorage(allData);

                    // Actualizar data manager
                    this.dataManager.updateRealData(allData);

                    console.log('📊 Sistema real activo con', allData.length, 'reseñas verificadas');
                    dataCache.isLoading = false;
                    return;
                }
            } else {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
        } catch (error) {
            console.log('⚠️ Error conectando con Google Sheets:', error.message);

            // Intentar cargar desde localStorage
            if (this.loadFromLocalStorage()) {
                dataCache.isLoading = false;
                return;
            }
        }

        // Fallback a datos demo si no hay datos reales
        console.log('💡 Fallback: Generando datos demo para reseñas');
        this.generateDemoReviews();
        dataCache.isLoading = false;
    }

    // Verificar si el caché es válido
    isCacheValid() {
        return dataCache.data &&
               dataCache.lastUpdate &&
               (Date.now() - dataCache.lastUpdate) < CONFIG.CACHE_TIMEOUT;
    }

    // Guardar en localStorage
    saveToLocalStorage(data) {
        try {
            const cacheData = {
                data: data,
                timestamp: Date.now(),
                version: '3.0'
            };
            localStorage.setItem('caserocheck_cache', JSON.stringify(cacheData));
            console.log('💾 Datos guardados en caché local');
        } catch(e) {
            console.log('⚠️ No se pudo guardar caché local:', e.message);
        }
    }

    // Cargar desde localStorage
    loadFromLocalStorage() {
        try {
            const cached = localStorage.getItem('caserocheck_cache');
            if (cached) {
                const parsedCache = JSON.parse(cached);
                const age = Date.now() - parsedCache.timestamp;

                if (age < CONFIG.OFFLINE_CACHE_TIMEOUT && parsedCache.version === '3.0') {
                    allData = parsedCache.data;
                    dataCache.data = allData;
                    dataCache.lastUpdate = parsedCache.timestamp;
                    this.dataManager.updateRealData(allData);
                    console.log('📱 Datos cargados desde caché offline (', Math.round(age/60000), 'min antiguos)');
                    return true;
                }
            }
        } catch (error) {
            console.log('❌ Error leyendo caché local:', error);
        }
        return false;
    }

    // Procesar datos reales desde Google Sheets
    processRealData(rawData) {
        return rawData.map(row => ({
            id: row[COLUMNS.ID] || Math.random().toString(36),
            fecha: row[COLUMNS.FECHA] || new Date().toLocaleDateString(),
            direccion: row[COLUMNS.DIRECCION] || '',
            codigoPostal: row[COLUMNS.CODIGO_POSTAL] || '',
            distrito: row[COLUMNS.DISTRITO] || '',
            precioPagado: parseFloat(row[COLUMNS.PRECIO_PAGADO]) || 0,
            precioAnunciado: parseFloat(row[COLUMNS.PRECIO_ANUNCIADO]) || 0,
            duracionAlquiler: row[COLUMNS.DURACION_ALQUILER] || '',
            tipoPropiedad: row[COLUMNS.TIPO_PROPIEDAD] || '',
            metros: parseFloat(row[COLUMNS.METROS]) || 0,
            habitaciones: parseInt(row[COLUMNS.HABITACIONES]) || 0,
            banos: parseInt(row[COLUMNS.BANOS]) || 0,
            amueblado: row[COLUMNS.AMUEBLADO] || '',
            calificacionGlobal: parseFloat(row[COLUMNS.CALIFICACION_GLOBAL]) || 0,
            estadoPiso: parseFloat(row[COLUMNS.ESTADO_PISO]) || 0,
            limpieza: parseFloat(row[COLUMNS.LIMPIEZA]) || 0,
            ubicacion: parseFloat(row[COLUMNS.UBICACION]) || 0,
            calidadPrecio: parseFloat(row[COLUMNS.CALIDAD_PRECIO]) || 0,
            comunicacionCasero: parseFloat(row[COLUMNS.COMUNICACION_CASERO]) || 0,
            tiempoRespuesta: row[COLUMNS.TIEMPO_RESPUESTA] || '',
            problemasReportados: row[COLUMNS.PROBLEMAS_REPORTADOS] || '',
            devolucionFianza: row[COLUMNS.DEVOLUCION_FIANZA] || '',
            tiempoDevolucion: row[COLUMNS.TIEMPO_DEVOLUCION] || '',
            resenaDetallada: row[COLUMNS.RESENA_DETALLADA] || '',
            recomendarias: row[COLUMNS.RECOMENDARIAS] || '',
            verificado: row[COLUMNS.VERIFICADO] || 'No',
            estadoModeracion: row[COLUMNS.ESTADO_MODERACION] || 'Pendiente'
        })).filter(item => item.direccion && item.calificacionGlobal > 0);
    }

    // Generar datos demo para reseñas si no hay datos reales
    generateDemoReviews() {
        const distritos = ['Centro', 'Salamanca', 'Chamberí', 'Retiro', 'Usera', 'Carabanchel', 'Tetuán'];
        const direcciones = [
            'Gran Vía 45, 1º A', 'Calle Fuencarral 23, 2º B', 'Plaza Mayor 12, 3º C', 'Calle Alcalá 67, 1º D',
            'Paseo del Prado 89, 4º A', 'Calle Serrano 34, 2º C', 'Avenida de América 56, 3º B'
        ];
        const tipos = ['Piso', 'Estudio', 'Ático', 'Loft'];

        allData = [];
        for (let i = 0; i < 25; i++) {
            const distrito = distritos[Math.floor(Math.random() * distritos.length)];
            const direccion = direcciones[Math.floor(Math.random() * direcciones.length)];

            // Precios realistas por distrito
            let precioBase = 900;
            switch(distrito) {
                case 'Centro': precioBase = 1300; break;
                case 'Salamanca': precioBase = 1500; break;
                case 'Chamberí': precioBase = 1200; break;
                case 'Retiro': precioBase = 1250; break;
                case 'Usera': precioBase = 750; break;
                case 'Carabanchel': precioBase = 800; break;
                case 'Tetuán': precioBase = 950; break;
            }

            const precio = precioBase + Math.random() * 300 - 150;
            const rating = 3.5 + Math.random() * 1.5; // Rating entre 3.5 y 5.0

            allData.push({
                id: `demo-${i}`,
                fecha: new Date(2024, Math.floor(Math.random() * 12), Math.floor(Math.random() * 28) + 1).toLocaleDateString('es-ES'),
                direccion: direccion,
                distrito: distrito,
                precioPagado: Math.round(precio),
                precioAnunciado: Math.round(precio + Math.random() * 200 - 50),
                tipoPropiedad: tipos[Math.floor(Math.random() * tipos.length)],
                metros: Math.round(50 + Math.random() * 100),
                habitaciones: 1 + Math.floor(Math.random() * 3),
                banos: 1 + Math.floor(Math.random() * 2),
                amueblado: Math.random() > 0.4 ? 'Sí' : 'No',
                calificacionGlobal: Math.round(rating * 10) / 10,
                estadoPiso: Math.round((3 + Math.random() * 2) * 10) / 10,
                limpieza: Math.round((3.5 + Math.random() * 1.5) * 10) / 10,
                ubicacion: Math.round((3.5 + Math.random() * 1.5) * 10) / 10,
                calidadPrecio: Math.round((2.5 + Math.random() * 2.5) * 10) / 10,
                comunicacionCasero: Math.round((3 + Math.random() * 2) * 10) / 10,
                devolucionFianza: Math.random() > 0.3 ? 'Sí, completa' : 'Sí, parcial',
                resenaDetallada: `Experiencia de alquiler en ${distrito}. ${Math.random() > 0.5 ? 'Muy positiva en general.' : 'Algunas cosas que mejorar pero aceptable.'} El casero fue ${Math.random() > 0.6 ? 'muy profesional' : 'correcto'}.`,
                recomendarias: Math.random() > 0.25 ? 'Sí' : 'No',
                verificado: 'Sí',
                estadoModeracion: 'Aprobada'
            });
        }

        this.dataManager.updateRealData(allData);
        console.log(`✅ ${allData.length} reseñas demo generadas para testing`);
    }

    // ==========================================
    // ACTUALIZACIÓN DE HERO STATS REALES
    // ==========================================
    updateHeroStats() {
        const stats = this.dataManager.getRealData().heroStats;

        // Actualizar Hero Stats con animación
        this.animateCountUp('totalReviews', stats.totalReviews);
        this.animateCountUp('avgRating', stats.avgRating, 1);
        this.animateCountUp('districts', stats.districts);
        this.animateCountUp('totalProperties', stats.totalProperties);

        console.log('📊 Hero Stats actualizadas:', stats);
    }

    // Animación de conteo hacia arriba
    animateCountUp(elementId, finalValue, decimals = 0) {
        const element = document.getElementById(elementId);
        if (!element) return;

        const duration = 1500;
        const steps = 60;
        const increment = finalValue / steps;
        let current = 0;
        let step = 0;

        const timer = setInterval(() => {
            current += increment;
            step++;

            if (step >= steps) {
                current = finalValue;
                clearInterval(timer);
            }

            if (decimals > 0) {
                element.textContent = current.toFixed(decimals);
            } else {
                element.textContent = Math.floor(current);
            }
        }, duration / steps);
    }

    // Obtener instancia del data manager (para otros componentes)
    getDataManager() {
        return this.dataManager;
    }

    // Verificar si el sistema está listo
    isReady() {
        return this.isInitialized;
    }

    // Manejar error de inicialización
    handleInitError() {
        console.error('💥 Error crítico en inicialización');

        // Mostrar mensaje de error al usuario
        const heroStats = document.querySelector('.hero-stats');
        if (heroStats) {
            heroStats.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; color: var(--danger);">
                    ⚠️ Error cargando datos. Recargando página...
                </div>
            `;
        }

        // Recargar después de 3 segundos
        setTimeout(() => {
            window.location.reload();
        }, 3000);
    }

    // Continúa en Parte 3B...
</script>
<!-- PARTE 3B: SISTEMA DE BÚSQUEDA + FUNCIONES GLOBALES -->
<!-- Insertar DESPUÉS de la Parte 3A -->

<script>
// ==========================================
// CONTINUACIÓN CLASE CASEROCHECK - BÚSQUEDAS
// ==========================================

// Agregar métodos a la clase CaseroCheck (continuación)
CaseroCheck.prototype.initializeSearch = function() {
    const searchForm = document.getElementById('searchForm');
    if (!searchForm) return;

    searchForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        await this.performSearch();
    });

    // Búsqueda en tiempo real (debounced)
    const searchInputs = searchForm.querySelectorAll('input, select');
    searchInputs.forEach(input => {
        let debounceTimer;
        input.addEventListener('input', () => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                if (this.hasSearchCriteria()) {
                    this.performSearch();
                }
            }, 800);
        });
    });
};

CaseroCheck.prototype.hasSearchCriteria = function() {
    const form = document.getElementById('searchForm');
    const formData = new FormData(form);

    for (let [key, value] of formData.entries()) {
        if (value.trim() !== '') return true;
    }
    return false;
};

CaseroCheck.prototype.performSearch = async function() {
    const filters = this.getSearchFilters();

    // Mostrar loading
    this.showLoading();

    try {
        // Simular tiempo de búsqueda realista
        await new Promise(resolve => setTimeout(resolve, 1200));

        const results = this.searchRealData(filters);
        this.displaySearchResults(results);

        // Analytics tracking
        this.trackSearchEvent(filters, results.total);

    } catch (error) {
        console.error('❌ Error en búsqueda:', error);
        this.showSearchError();
    } finally {
        this.hideLoading();
    }
};

CaseroCheck.prototype.getSearchFilters = function() {
    return {
        direccion: document.getElementById('direccion')?.value?.trim() || '',
        distrito: document.getElementById('distrito')?.value || '',
        precioMin: parseInt(document.getElementById('precioMin')?.value) || null,
        precioMax: parseInt(document.getElementById('precioMax')?.value) || null,
        habitaciones: document.getElementById('habitaciones')?.value || null,
        tipoPropiedad: document.getElementById('tipoPropiedad')?.value || '',
        amueblado: document.getElementById('amueblado')?.value || '',
        ratingMin: parseFloat(document.getElementById('ratingMin')?.value) || null
    };
};

CaseroCheck.prototype.searchRealData = function(filters) {
    const reviews = this.dataManager.getRealData().reviews;

    const results = reviews.filter(item => {
        // Filtro por dirección
        if (filters.direccion && !item.direccion.toLowerCase().includes(filters.direccion.toLowerCase())) {
            return false;
        }

        // Filtro por distrito
        if (filters.distrito && item.distrito !== filters.distrito) {
            return false;
        }

        // Filtros de precio
        if (filters.precioMin && item.precioPagado < filters.precioMin) {
            return false;
        }
        if (filters.precioMax && item.precioPagado > filters.precioMax) {
            return false;
        }

        // Filtro por habitaciones
        if (filters.habitaciones !== null && filters.habitaciones !== '' &&
            item.habitaciones != filters.habitaciones) {
            return false;
        }

        // Filtro por tipo de propiedad
        if (filters.tipoPropiedad && !item.tipoPropiedad.toLowerCase().includes(filters.tipoPropiedad.toLowerCase())) {
            return false;
        }

        // Filtro por amueblado
        if (filters.amueblado && item.amueblado !== filters.amueblado) {
            return false;
        }

        // Filtro por rating mínimo
        if (filters.ratingMin && item.calificacionGlobal < filters.ratingMin) {
            return false;
        }

        return true;
    }).sort((a, b) => b.calificacionGlobal - a.calificacionGlobal);

    // Calcular estadísticas de resultados
    const stats = this.calculateSearchStats(results);

    return {
        results: results,
        stats: stats,
        total: results.length,
        filters: filters
    };
};

CaseroCheck.prototype.calculateSearchStats = function(results) {
    if (results.length === 0) {
        return { avgRating: 0, avgPrice: 0, recommendationRate: 0 };
    }

    const avgRating = results.reduce((sum, item) => sum + item.calificacionGlobal, 0) / results.length;
    const avgPrice = results.reduce((sum, item) => sum + item.precioPagado, 0) / results.length;
    const recommendations = results.filter(item => item.recomendarias.toLowerCase().includes('sí')).length;
    const recommendationRate = (recommendations / results.length) * 100;

    return {
        avgRating: Math.round(avgRating * 10) / 10,
        avgPrice: Math.round(avgPrice),
        recommendationRate: Math.round(recommendationRate)
    };
};

CaseroCheck.prototype.displaySearchResults = function(data) {
    const container = document.getElementById('searchResults');
    if (!container) return;

    if (data.total === 0) {
        container.innerHTML = `
            <div class="no-results">
                <div class="no-results-icon">🏠</div>
                <h3>No se encontraron propiedades</h3>
                <p>Prueba ajustando los filtros o sé el primero en reseñar una propiedad en esta zona.</p>
                <div class="no-results-actions">
                    <button class="btn btn-primary" onclick="switchTabAndScroll('write')">
                        ✍️ Escribir Primera Reseña
                    </button>
                </div>
            </div>
        `;
        return;
    }

    let html = `
        <div class="results-stats">
            <div class="results-header">
                <h3>📊 Resultados de Búsqueda</h3>
                <p>Encontradas <strong>${data.total}</strong> propiedades que coinciden con tus criterios</p>
            </div>

            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number">${data.total}</div>
                    <div class="stat-label">Propiedades</div>
                    <div class="stat-badge real">📊 REAL</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${data.stats.avgRating}/5</div>
                    <div